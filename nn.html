<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPIRS | Smart Public Issue Reporting System</title>
    <style>
        :root {
            /* Updated to a more vibrant, colorful palette */
            --primary: #8b5cf6; /* Vibrant Violet */
            --secondary: #06b6d4; /* Bright Cyan */
            --accent: #f43f5e; /* Rose Pink */
            --success: #10b981; /* Emerald Green */
            --danger: #f97316; /* Bright Orange */
            --bg: #eef2ff;
            --glass: rgba(255, 255, 255, 0.95);
            --card-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        body { 
            margin: 0; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            color: #1e293b; 
            line-height: 1.5;
        }

        header {
            /* More colorful gradient header */
            background: linear-gradient(135deg, #6366f1 0%, #d946ef 50%, #06b6d4 100%);
            color: white; 
            padding: 90px 20px; 
            text-align: center;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 0% 100%);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        header h1 { font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }

        .container { max-width: 1200px; margin: -60px auto 50px; padding: 0 20px; }

        .section {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border-radius: 40px; 
            padding: 50px;
            box-shadow: var(--card-shadow);
            display: none; 
            animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            border: 2px solid rgba(255,255,255,0.8);
        }

        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(40px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        .active { display: block; }

        .stats-bar {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 25px; margin-bottom: 40px;
        }
        .stat-card {
            padding: 30px; border-radius: 25px; background: white;
            text-align: center; border-bottom: 8px solid #eee;
            transition: all 0.3s ease; box-shadow: 0 10px 15px rgba(0,0,0,0.05);
            cursor: pointer;
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .stat-pending { border-color: var(--accent); color: var(--accent); }
        .stat-progress { border-color: var(--secondary); color: var(--secondary); }
        .stat-complete { border-color: var(--success); color: var(--success); }

        .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }
        .card {
            padding: 50px 20px; border-radius: 35px; color: white; text-align: center;
            cursor: pointer; transition: all 0.4s ease;
            position: relative; overflow: hidden;
            box-shadow: 0 15px 25px rgba(0,0,0,0.1);
        }
        .card:hover { transform: translateY(-15px) scale(1.02); box-shadow: 0 25px 40px rgba(0,0,0,0.2); }
        
        /* Vibrant gradients for access portal */
        .citizen { background: linear-gradient(135deg, #14b8a6, #3b82f6); }
        .admin { background: linear-gradient(135deg, #f43f5e, #fb923c); }
        .worker { background: linear-gradient(135deg, #8b5cf6, #d946ef); }
        
        .dept { 
            background: white; color: #4338ca; border: 3px solid #eef2ff; 
            font-weight: bold; font-size: 1.1rem;
        }
        .dept:hover { background: #f5f3ff; border-color: var(--primary); color: var(--primary); }

        .issue-item {
            background: #ffffff; border-radius: 30px; padding: 30px;
            margin-bottom: 30px; display: flex; gap: 30px;
            border: 1px solid #e2e8f0; transition: 0.3s;
            box-shadow: 0 10px 20px rgba(0,0,0,0.02);
        }

        .photo-stack { display: flex; flex-direction: column; gap: 15px; }
        .img-container { position: relative; width: 180px; text-align: center; }
        .issue-img {
            width: 180px; height: 180px; object-fit: cover; border-radius: 25px;
            cursor: pointer; transition: 0.4s; border: 4px solid #f8fafc;
        }
        .issue-img:hover { border-color: var(--primary); transform: rotate(2deg); }

        .badge {
            padding: 8px 20px; border-radius: 50px; font-size: 0.8rem;
            font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
        }
        .bg-pending { background: #fff1f2; color: #e11d48; }
        .bg-progress { background: #ecfeff; color: #0891b2; }
        .bg-completed { background: #f0fdf4; color: #166534; }

        input, select, textarea {
            width: 100%; padding: 16px; margin: 12px 0; border-radius: 18px;
            border: 2px solid #e2e8f0; box-sizing: border-box; font-size: 1rem;
            transition: 0.3s; background: #fcfcfd;
        }
        input:focus, select:focus, textarea:focus { 
            border-color: var(--primary); outline: none; box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1); 
        }

        button {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white; border: none; padding: 18px 35px;
            border-radius: 18px; cursor: pointer; font-weight: 800; width: 100%;
            font-size: 1.1rem; transition: 0.4s; margin-top: 15px;
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(139, 92, 246, 0.4); filter: brightness(1.1); }
        
        .btn-back { background: #94a3b8; box-shadow: 0 8px 15px rgba(148, 163, 184, 0.2); }

        #imgModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.95); display: none; z-index: 1000;
            justify-content: center; align-items: center;
        }
        #imgModal img { max-width: 85%; max-height: 80%; border-radius: 30px; border: 8px solid white; box-shadow: 0 0 50px rgba(0,0,0,0.5); }

        footer { text-align: center; padding: 60px; color: #94a3b8; font-weight: 600; letter-spacing: 1px; }
    </style>
</head>
<body>

<header>
    <h1>üèôÔ∏è Smart Public Issue Reporting System</h1>
    <p>Empowering Citizens for a Better Infrastructure</p>
</header>

<div class="container">
    
    <div id="home" class="section active">
        <h2 style="text-align: center; margin-bottom: 50px; color: #4338ca; font-size: 2rem;">Welcome to the Portal</h2>
        <div class="cards">
            <div class="card citizen" onclick="nav('citizen')">
                <div style="font-size: 70px;">üì∏</div>
                <h3>Report Issue</h3>
                <p>Snapshot and Submit</p>
            </div>
            <div class="card admin" onclick="nav('deptSelect')">
                <div style="font-size: 70px;">üè¢</div>
                <h3>Area Head</h3>
                <p>Department Management</p>
            </div>
            <div class="card worker" onclick="nav('worker')">
                <div style="font-size: 70px;">üõ†Ô∏è</div>
                <h3>Field Squad</h3>
                <p>Task Tracking</p>
            </div>
        </div>
    </div>

    <div id="citizen" class="section">
        <h2 style="color: var(--primary); text-align:center;">üì¢ New Incident Report</h2>
        <label><b>Nature of Problem</b></label>
        <select id="ctype">
            <option value="">-- Please Select the Problem --</option>
            <option value="Waste">Waste Management</option>
            <option value="Water">Water Supply</option>
            <option value="Electricity">Electricity/Lamps</option>
            <option value="Roads">Roads & Potholes</option>
        </select>
        <label><b>Location Details</b></label>
        <input type="text" id="cloc" placeholder="e.g. Near Blue Mall, 2nd Cross">
        <label><b>Describe the Issue</b></label>
        <textarea id="cdesc" rows="3" placeholder="Additional details to help our squad..."></textarea>
        <label><b>Upload Visual Evidence</b></label>
        <input type="file" id="cfile" accept="image/*">
        <button onclick="saveIssue()">üöÄ Submit Report to Squad</button>
        <button class="btn-back" onclick="nav('home')">Cancel and Back</button>
    </div>

    <div id="deptSelect" class="section">
        <h2 style="text-align: center; color: #4338ca;">Select Department</h2>
        <div class="cards">
            <div class="card dept" onclick="openLogin('Waste')">üóëÔ∏è Waste Mgmt</div>
            <div class="card dept" onclick="openLogin('Water')">üö∞ Water Supply</div>
            <div class="card dept" onclick="openLogin('Electricity')">üí° Electrical</div>
            <div class="card dept" onclick="openLogin('Roads')">üõ£Ô∏è Public Works</div>
        </div>
        <button class="btn-back" onclick="nav('home')">Back to Home</button>
    </div>

    <div id="login" class="section">
        <h2 id="loginTitle" style="text-align:center; color: var(--primary);">Area Head Login</h2>
        <div style="max-width: 400px; margin: 0 auto;">
            <label><b>Username</b></label>
            <input type="text" id="loginUser" placeholder="Username">
            <label><b>Password</b></label>
            <input type="password" id="loginPass" placeholder="Password">
            <button onclick="doLogin()">Unlock Dashboard</button>
            <button class="btn-back" onclick="nav('deptSelect')">Return</button>
        </div>
    </div>

    <div id="admin" class="section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2 id="adminTitle" style="color: var(--primary); margin:0;">Dashboard</h2>
            <button class="btn-back" onclick="nav('deptSelect')" style="width: auto; margin: 0; padding: 10px 25px;">Logout</button>
        </div>
        
        <div class="stats-bar">
            <div class="stat-card stat-pending" onclick="renderAdmin('Pending')">
                <div id="stat-p" style="font-size: 40px; font-weight: 900;">0</div>
                <div style="font-size: 13px; font-weight: 800;">NEW REPORTS</div>
            </div>
            <div class="stat-card stat-progress" onclick="renderAdmin('In Progress')">
                <div id="stat-i" style="font-size: 40px; font-weight: 900;">0</div>
                <div style="font-size: 13px; font-weight: 800;">FIXING</div>
            </div>
            <div class="stat-card stat-complete" onclick="renderAdmin('Completed')">
                <div id="stat-c" style="font-size: 40px; font-weight: 900;">0</div>
                <div style="font-size: 13px; font-weight: 800;">RESOLVED</div>
            </div>
        </div>
        <p style="text-align:center; font-size: 0.9rem; color: #64748b; font-weight: 600;">Tap a status card to filter the issues below</p>

        <div id="adminIssues"></div>
    </div>

    <div id="worker" class="section">
        <h2 style="color: var(--primary);">üõ†Ô∏è Field Task Sync</h2>
        <label><b>Select Squad Name</b></label>
        <select id="workerName" onchange="renderWorker()">
            <option value="">Identify yourself...</option>
            <option>John Smith (Squad A)</option>
            <option>Mike Ross (Squad B)</option>
        </select>
        <div id="workerIssues" style="margin-top:30px;"></div>
        <button class="btn-back" onclick="nav('home')">Exit to Home</button>
    </div>

</div>

<div id="imgModal" onclick="this.style.display='none'">
    <img id="modalImg" src="">
</div>

<footer>Powered by SPIRS Municipal AI ‚Ä¢ 2026</footer>

<script>
    let issues = [];
    let currentDept = "";

    function nav(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function openLogin(dept) {
        currentDept = dept;
        document.getElementById('loginTitle').innerText = dept + " Head Login";
        nav('login');
    }

    function doLogin() {
        const u = document.getElementById('loginUser').value;
        const p = document.getElementById('loginPass').value;
        if(u && p) {
            renderAdmin(); 
            nav('admin');
        } else {
            alert("Security Error: Please provide credentials.");
        }
    }

    function zoom(src) {
        document.getElementById('modalImg').src = src;
        document.getElementById('imgModal').style.display = 'flex';
    }

    function saveIssue() {
        const fileInput = document.getElementById('cfile');
        const locInput = document.getElementById('cloc');
        const typeInput = document.getElementById('ctype');
        const descInput = document.getElementById('cdesc');
        
        if(!fileInput.files[0] || !locInput.value || !typeInput.value) {
            return alert("Wait! We need the photo, type, and location to help.");
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            issues.push({
                id: Date.now(),
                dept: typeInput.value,
                loc: locInput.value,
                desc: descInput.value,
                status: 'Pending',
                photo: e.target.result,
                worker: null,
                finalPhoto: null
            });

            alert("Mission Accomplished! The department has been notified.");

            // Clear fields so it's fresh for next time
            locInput.value = "";
            typeInput.value = "";
            descInput.value = "";
            fileInput.value = "";

            nav('home');
        };
        reader.readAsDataURL(fileInput.files[0]);
    }

    function renderAdmin(filterStatus = null) {
        document.getElementById('adminTitle').innerText = currentDept + " Control Panel";
        const list = document.getElementById('adminIssues');
        
        let filtered = issues.filter(i => i.dept === currentDept);
        
        document.getElementById('stat-p').innerText = filtered.filter(i => i.status === 'Pending').length;
        document.getElementById('stat-i').innerText = filtered.filter(i => i.status === 'In Progress').length;
        document.getElementById('stat-c').innerText = filtered.filter(i => i.status === 'Completed').length;

        if(filterStatus) {
            filtered = filtered.filter(i => i.status === filterStatus);
        }

        list.innerHTML = filtered.length ? "" : `<div style='text-align:center; padding:60px; color:#94a3b8; font-style:italic;'>Queue is currently empty for ${filterStatus || 'this department'}.</div>`;

        filtered.forEach(i => {
            const sClass = i.status === 'Pending' ? 'bg-pending' : (i.status === 'In Progress' ? 'bg-progress' : 'bg-completed');
            list.innerHTML += `
                <div class="issue-item">
                    <div class="photo-stack">
                        <div class="img-container">
                            <small style="color:var(--accent)"><b>BEFORE</b></small>
                            <img src="${i.photo}" class="issue-img" onclick="zoom(this.src)">
                        </div>
                        ${i.finalPhoto ? `
                        <div class="img-container">
                            <small style="color:var(--success)"><b>RESOLVED</b></small>
                            <img src="${i.finalPhoto}" class="issue-img" onclick="zoom(this.src)">
                        </div>` : ''}
                    </div>
                    <div style="flex:1">
                        <span class="badge ${sClass}">${i.status}</span>
                        <h3 style="margin:15px 0 5px 0; color:#1e1b4b; font-size:1.4rem;">${i.loc}</h3>
                        <p style="color:#64748b; font-size:1rem; margin-bottom:20px;">${i.desc || 'No additional details provided.'}</p>
                        <div style="background:#f8fafc; padding:20px; border-radius:20px; border:1px solid #e2e8f0;">
                            ${i.status === 'Pending' ? `
                                <label style="font-size:0.85rem; font-weight:800; color:var(--primary);">DISPATCH SQUAD:</label>
                                <select onchange="assignWorker(${i.id}, this.value)">
                                    <option value="">Select Personnel...</option>
                                    <option>John Smith (Squad A)</option>
                                    <option>Mike Ross (Squad B)</option>
                                </select>
                            ` : `<span style="font-weight:bold; color:var(--primary);">Personnel In Charge:</span> ${i.worker}`}
                        </div>
                    </div>
                </div>
            `;
        });
    }

    function assignWorker(id, worker) {
        if(!worker) return;
        let issue = issues.find(x => x.id === id);
        issue.worker = worker;
        issue.status = "In Progress";
        renderAdmin();
    }

    function renderWorker() {
        const worker = document.getElementById('workerName').value;
        const list = document.getElementById('workerIssues');
        const activeTasks = issues.filter(i => i.worker === worker && i.status === 'In Progress');
        
        list.innerHTML = activeTasks.length ? "" : "<p style='text-align:center; padding:40px; color:#94a3b8;'>Great job! No pending tasks in your queue.</p>";

        activeTasks.forEach(i => {
            list.innerHTML += `
                <div class="issue-item">
                    <img src="${i.photo}" class="issue-img">
                    <div style="flex:1">
                        <span class="badge bg-progress">Job Active</span>
                        <h3>${i.loc}</h3>
                        <p>${i.desc}</p>
                        <div style="background:#f1f5f9; padding:25px; border-radius:25px; border:3px dashed var(--primary)">
                            <label><b>üì∏ Capture Resolved Evidence:</b></label>
                            <input type="file" id="f-${i.id}" accept="image/*">
                            <button onclick="finishTask(${i.id})" style="background:var(--success)">‚úÖ Confirm Completion</button>
                        </div>
                    </div>
                </div>
            `;
        });
    }

    function finishTask(id) {
        const fileInput = document.getElementById(`f-${id}`);
        if(!fileInput.files[0]) return alert("Visual proof of resolution is mandatory before closing.");

        const reader = new FileReader();
        reader.onload = function(e) {
            let issue = issues.find(x => x.id === id);
            issue.finalPhoto = e.target.result;
            issue.status = "Completed";
            alert("Well done, Squad! The report is now marked as Resolved.");
            renderWorker();
        };
        reader.readAsDataURL(fileInput.files[0]);
    }
</script>
</body>
</html>